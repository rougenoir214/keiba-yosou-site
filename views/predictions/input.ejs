<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äºˆæƒ³å…¥åŠ› - <%= race.race_name %></title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 1200px; margin: 0 auto; }
.header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
.header h1 { color: #333; margin-bottom: 10px; }
.back-link { display: inline-block; margin-top: 10px; color: #667eea; text-decoration: none; }
.back-link:hover { text-decoration: underline; }
.section { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
.section h2 { color: #333; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
table { width: 100%; border-collapse: collapse; }
th { background: #667eea; color: white; padding: 12px; text-align: left; }
td { padding: 12px; border-bottom: 1px solid #eee; }
.mark-select { padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 16px; }
.waku { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; }
.waku-1 { background: white; color: #333; border: 2px solid #333; }
.waku-2 { background: black; }
.waku-3 { background: red; }
.waku-4 { background: blue; }
.waku-5 { background: yellow; color: #333; }
.waku-6 { background: green; }
.waku-7 { background: orange; }
.waku-8 { background: pink; color: #333; }
.btn { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
.btn:hover { background: #5568d3; }
.btn-success { background: #4caf50; }
.btn-success:hover { background: #45a049; }
.btn-danger { background: #f44336; }
.btn-danger:hover { background: #da190b; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
.form-group select, .form-group input { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px; }
.bet-list { list-style: none; }
.bet-item { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
.bet-info { flex: 1; }
.total-amount { font-size: 20px; font-weight: bold; color: #667eea; margin-top: 15px; }
.remaining-amount { color: #4caf50; margin-top: 5px; }
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>ğŸ“ äºˆæƒ³å…¥åŠ› - <%= race.race_name %></h1>
<p>ãƒ¦ãƒ¼ã‚¶ãƒ¼: <%= user.display_name %></p>
<a href="/races/<%= race.race_id %>" class="back-link">â† å‡ºé¦¬è¡¨ã«æˆ»ã‚‹</a>
</div>
<div class="section">
<h2>ğŸ¯ å°ã‚’å…¥åŠ›</h2>
<form id="marks-form">
<table>
<thead><tr><th>æ </th><th>é¦¬ç•ª</th><th>é¦¬å</th><th>é¨æ‰‹</th><th>å°</th></tr></thead>
<tbody>
<% const existingMarks = {}; predictions.forEach(p => { existingMarks[p.umaban] = p.mark; }); %>
<% horses.forEach(horse => { %>
<tr>
<td><div class="waku waku-<%= horse.waku %>"><%= horse.waku %></div></td>
<td><strong><%= horse.umaban %></strong></td>
<td><%= horse.horse_name %></td>
<td><%= horse.jockey %></td>
<td><select name="mark_<%= horse.umaban %>" class="mark-select">
<option value="">-</option>
<option value="â—" <%= existingMarks[horse.umaban] === 'â—' ? 'selected' : '' %>>â—</option>
<option value="â—‹" <%= existingMarks[horse.umaban] === 'â—‹' ? 'selected' : '' %>>â—‹</option>
<option value="â–²" <%= existingMarks[horse.umaban] === 'â–²' ? 'selected' : '' %>>â–²</option>
<option value="â–³" <%= existingMarks[horse.umaban] === 'â–³' ? 'selected' : '' %>>â–³</option>
<option value="â˜†" <%= existingMarks[horse.umaban] === 'â˜†' ? 'selected' : '' %>>â˜†</option>
</select></td>
</tr>
<% }); %>
</tbody>
</table>
<button type="submit" class="btn btn-success" style="margin-top: 15px;">å°ã‚’ä¿å­˜</button>
</form>
</div>
<div class="section">
<h2>ğŸ’° é¦¬åˆ¸ã‚’è³¼å…¥</h2>
<form id="bet-form">
<div class="form-group">
<label for="bet_type">é¦¬åˆ¸ç¨®åˆ¥</label>
<select id="bet_type" name="bet_type" required>
<option value="tansho">å˜å‹</option>
<option value="fukusho">è¤‡å‹</option>
<option value="umaren">é¦¬é€£</option>
<option value="umatan">é¦¬å˜</option>
<option value="wide">ãƒ¯ã‚¤ãƒ‰</option>
<option value="sanrenpuku">3é€£è¤‡</option>
<option value="sanrentan">3é€£å˜</option>
</select>
</div>
<div class="form-group" id="buy-method-group">
<label>è³¼å…¥æ–¹æ³•</label>
<div style="display: flex; gap: 20px;">
<label style="display: flex; align-items: center; gap: 5px;"><input type="radio" name="buy_method" value="normal" checked> é€šå¸¸</label>
<label style="display: flex; align-items: center; gap: 5px;" id="box-option"><input type="radio" name="buy_method" value="box"> ãƒœãƒƒã‚¯ã‚¹</label>
<label style="display: flex; align-items: center; gap: 5px;" id="formation-option"><input type="radio" name="buy_method" value="formation"> ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</label>
</div>
</div>
<div id="normal-input" class="buy-method-inputs">
<div class="form-group">
<label for="horses_input">é¦¬ç•ªï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
<input type="text" id="horses_input" name="horses" placeholder="ä¾‹: 1,3,5">
<small id="normal-help">å˜å‹ãƒ»è¤‡å‹ã¯1é ­ã€é¦¬é€£ãƒ»é¦¬å˜ãƒ»ãƒ¯ã‚¤ãƒ‰ã¯2é ­ã€3é€£è¤‡ãƒ»3é€£å˜ã¯3é ­</small>
</div>
</div>
<div id="box-input" class="buy-method-inputs" style="display: none;">
<div class="form-group">
<label for="box_horses">é¸æŠé¦¬ç•ªï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
<input type="text" id="box_horses" placeholder="ä¾‹: 1,3,5,7">
<small>å…¨çµ„ã¿åˆã‚ã›ãŒè‡ªå‹•ã§è³¼å…¥ã•ã‚Œã¾ã™</small>
</div>
</div>
<div id="formation-input" class="buy-method-inputs" style="display: none;">
<div id="formation-umatan" style="display: none;">
<div class="form-group">
<label for="umatan_first">1ç€ï¼ˆè»¸ãƒ»ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šå¯ï¼‰</label>
<input type="text" id="umatan_first" placeholder="ä¾‹: 1,3">
</div>
<div class="form-group">
<label for="umatan_second">2ç€ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
<input type="text" id="umatan_second" placeholder="ä¾‹: 5,7,9">
<small>1ç€â†’2ç€ã®å…¨çµ„ã¿åˆã‚ã›ãŒè³¼å…¥ã•ã‚Œã¾ã™</small>
</div>
</div>
<div id="formation-2ren" style="display: none;">
<div class="form-group">
<label for="axis_horses">è»¸é¦¬ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒ»è¤‡æ•°å¯ï¼‰</label>
<input type="text" id="axis_horses" placeholder="ä¾‹: 1,3">
<small>è»¸åŒå£«ã®çµ„ã¿åˆã‚ã›ã‚‚è³¼å…¥ã•ã‚Œã¾ã™</small>
</div>
<div class="form-group">
<label for="partner_horses">ç›¸æ‰‹é¦¬ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
<input type="text" id="partner_horses" placeholder="ä¾‹: 5,7,9">
</div>
</div>
<div id="formation-3ren" style="display: none;">
<div class="form-group">
<label for="first_horses">1ç€ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
<input type="text" id="first_horses" placeholder="ä¾‹: 1,3">
</div>
<div class="form-group">
<label for="second_horses">2ç€ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
<input type="text" id="second_horses" placeholder="ä¾‹: 5,7">
</div>
<div class="form-group">
<label for="third_horses">3ç€ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
<input type="text" id="third_horses" placeholder="ä¾‹: 9,11">
</div>
<small>å…¨çµ„ã¿åˆã‚ã›ãŒè‡ªå‹•ã§è³¼å…¥ã•ã‚Œã¾ã™</small>
</div>
</div>
<div class="form-group">
<label for="amount">1ç‚¹ã‚ãŸã‚Šé‡‘é¡ï¼ˆå††ï¼‰</label>
<input type="number" id="amount" name="amount" min="100" step="100" value="100" required>
</div>
<button type="submit" class="btn">é¦¬åˆ¸ã‚’è¿½åŠ </button>
</form>
</div>
<div class="section">
<h2>ğŸ« è³¼å…¥æ¸ˆã¿é¦¬åˆ¸</h2>
<ul class="bet-list">
<% if (bets.length === 0) { %>
<p style="color: #888;">ã¾ã é¦¬åˆ¸ã‚’è³¼å…¥ã—ã¦ã„ã¾ã›ã‚“</p>
<% } else { %>
<% const betTypeNames = { 'tansho': 'å˜å‹', 'fukusho': 'è¤‡å‹', 'umaren': 'é¦¬é€£', 'umatan': 'é¦¬å˜', 'wide': 'ãƒ¯ã‚¤ãƒ‰', 'sanrenpuku': '3é€£è¤‡', 'sanrentan': '3é€£å˜' }; let totalAmount = 0; %>
<% bets.forEach(bet => { totalAmount += bet.amount; %>
<li class="bet-item">
<div class="bet-info"><strong><%= betTypeNames[bet.bet_type] %></strong>: <%= bet.horses %> - <%= bet.amount.toLocaleString() %>å††</div>
<button class="btn btn-danger" onclick="deleteBet(<%= bet.id %>)">å‰Šé™¤</button>
</li>
<% }); %>
<div class="total-amount">åˆè¨ˆ: <span id="total-amount"><%= totalAmount.toLocaleString() %></span>å††</div>
<div class="remaining-amount">æ®‹ã‚Š: <%= (10000 - totalAmount).toLocaleString() %>å††</div>
<% } %>
</ul>
</div>
</div>
<script>
function updateBuyMethodOptions() {
const betType = document.getElementById('bet_type').value;
const isTanFuku = betType === 'tansho' || betType === 'fukusho';
document.getElementById('box-option').style.display = isTanFuku ? 'none' : 'flex';
document.getElementById('formation-option').style.display = isTanFuku ? 'none' : 'flex';
if (isTanFuku) {
document.querySelector('input[name="buy_method"][value="normal"]').checked = true;
document.querySelectorAll('.buy-method-inputs').forEach(div => div.style.display = 'none');
document.getElementById('normal-input').style.display = 'block';
}
}
function updateFormationInputs() {
const betType = document.getElementById('bet_type').value;
const isUmatan = betType === 'umatan';
const is3ren = betType === 'sanrenpuku' || betType === 'sanrentan';
const is2ren = betType === 'umaren' || betType === 'wide';
document.getElementById('formation-umatan').style.display = isUmatan ? 'block' : 'none';
document.getElementById('formation-2ren').style.display = is2ren ? 'block' : 'none';
document.getElementById('formation-3ren').style.display = is3ren ? 'block' : 'none';
}
document.getElementById('bet_type').addEventListener('change', () => {
updateBuyMethodOptions();
updateFormationInputs();
});
document.querySelectorAll('input[name="buy_method"]').forEach(radio => {
radio.addEventListener('change', (e) => {
document.querySelectorAll('.buy-method-inputs').forEach(div => div.style.display = 'none');
document.getElementById(e.target.value + '-input').style.display = 'block';
updateFormationInputs();
});
});
updateBuyMethodOptions();
document.getElementById('marks-form').addEventListener('submit', async (e) => {
e.preventDefault();
const formData = new FormData(e.target);
const marks = {};
for (const [key, value] of formData.entries()) {
if (key.startsWith('mark_') && value) {
marks[key.replace('mark_', '')] = value;
}
}
try {
const r = await fetch('/predictions/<%= race.race_id %>/marks', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ marks })
});
alert(r.ok ? 'å°ã‚’ä¿å­˜ã—ã¾ã—ãŸ' : 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
} catch (error) { alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
});
document.getElementById('bet-form').addEventListener('submit', async (e) => {
e.preventDefault();
const formData = new FormData(e.target);
const buyMethod = formData.get('buy_method');
const betType = formData.get('bet_type');
let horses, axisHorses, partnerHorses, first, second, third;
if (buyMethod === 'normal') {
horses = document.getElementById('horses_input').value;
} else if (buyMethod === 'box') {
horses = document.getElementById('box_horses').value;
} else if (buyMethod === 'formation') {
if (betType === 'umatan') {
first = document.getElementById('umatan_first').value;
second = document.getElementById('umatan_second').value;
} else if (betType === 'sanrenpuku' || betType === 'sanrentan') {
first = document.getElementById('first_horses').value;
second = document.getElementById('second_horses').value;
third = document.getElementById('third_horses').value;
} else {
axisHorses = document.getElementById('axis_horses').value;
partnerHorses = document.getElementById('partner_horses').value;
}
}
const data = {
bet_type: betType,
horses: horses || '',
amount: formData.get('amount'),
buy_method: buyMethod,
axis_horses: axisHorses || '',
partner_horses: partnerHorses || '',
first: first || '',
second: second || '',
third: third || ''
};
try {
const r = await fetch('/predictions/<%= race.race_id %>/bets', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(data)
});
const result = await r.json();
if (r.ok) {
alert(`é¦¬åˆ¸ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼ˆ${result.count}ç‚¹ Ã— ${data.amount}å†† = ${result.total}å††ï¼‰`);
location.reload();
} else {
alert(result.error || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
}
} catch (error) { alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
});
async function deleteBet(betId) {
if (!confirm('ã“ã®é¦¬åˆ¸ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
try {
const r = await fetch(`/predictions/<%= race.race_id %>/bets/${betId}`, { method: 'DELETE' });
if (r.ok) { alert('é¦¬åˆ¸ã‚’å‰Šé™¤ã—ã¾ã—ãŸ'); location.reload(); } else { alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
} catch (error) { alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
}
</script>
</body>
</html>
