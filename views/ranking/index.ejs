<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ©ãƒ³ã‚­ãƒ³ã‚° - ç«¶é¦¬äºˆæƒ³å…±æœ‰ã‚µã‚¤ãƒˆ</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 1200px; margin: 0 auto; }
.header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
.header h1 { color: #333; margin-bottom: 10px; }
.back-link { display: inline-block; margin-top: 10px; color: #667eea; text-decoration: none; margin-right: 15px; }
.back-link:hover { text-decoration: underline; }

/* ã‚¿ãƒ– */
.tabs { display: flex; gap: 10px; margin-top: 15px; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap; }
.tab { padding: 10px 20px; cursor: pointer; border: none; background: none; font-size: 16px; color: #888; transition: all 0.3s; white-space: nowrap; }
.tab.active { color: #667eea; border-bottom: 3px solid #667eea; font-weight: bold; }
.tab:hover { color: #667eea; }

/* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¿ã‚¤ãƒ—ã‚¿ãƒ– */
.ranking-type-tabs { display: flex; gap: 8px; margin-top: 15px; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap; }
.ranking-type-tab { padding: 8px 16px; cursor: pointer; border: none; background: none; font-size: 14px; color: #888; transition: all 0.3s; white-space: nowrap; }
.ranking-type-tab.active { color: #764ba2; border-bottom: 3px solid #764ba2; font-weight: bold; }
.ranking-type-tab:hover { color: #764ba2; }

.season-selector { margin-top: 15px; }
.season-selector select { padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 14px; }

.section { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
.section h2 { color: #333; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
table { width: 100%; border-collapse: collapse; }
th { background: #667eea; color: white; padding: 12px; text-align: left; }
td { padding: 12px; border-bottom: 1px solid #eee; }
tr:hover { background: #f5f5f5; }

/* 1ä½ã€2ä½ã€3ä½ã®è‰²ã‚’æ”¹å–„ - ã‚·ãƒ³ãƒ—ãƒ«ï¼†ãƒ¢ãƒ€ãƒ³ */
.rank-1 { 
    background: rgba(124, 58, 237, 0.08) !important; 
    border-left: 4px solid #7C3AED !important;
    box-shadow: 0 2px 8px rgba(124, 58, 237, 0.15);
    font-weight: bold;
}
.rank-2 { 
    background: rgba(59, 130, 246, 0.08) !important; 
    border-left: 4px solid #3B82F6 !important;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
    font-weight: bold;
}
.rank-3 { 
    background: rgba(16, 185, 129, 0.08) !important; 
    border-left: 4px solid #10B981 !important;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
    font-weight: bold;
}

.profit-positive { color: #4caf50; font-weight: bold; }
.profit-negative { color: #f44336; font-weight: bold; }

.rank-badge { 
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px; 
    border-radius: 8px; 
    font-size: 14px;
    font-weight: 600;
}
.badge-1 { 
    background: linear-gradient(135deg, #7C3AED 0%, #A78BFA 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
}
.badge-2 { 
    background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}
.badge-3 { 
    background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
}

/* ã‚¹ãƒãƒ›å¯¾å¿œ */
@media (max-width: 768px) {
    body { padding: 10px; }
    .header, .section { padding: 15px; }
    .header h1 { font-size: 1.3rem; }
    .back-link { display: block; margin: 5px 0; }
    .tabs, .ranking-type-tabs { flex-wrap: wrap; }
    .tab { padding: 8px 12px; font-size: 14px; }
    .ranking-type-tab { padding: 6px 10px; font-size: 13px; }
    .season-selector { margin-top: 10px; }
    .season-selector select { width: 100%; font-size: 16px; }
    table { font-size: 0.85rem; display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    th, td { padding: 8px 4px; white-space: nowrap; }
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>

<!-- æœŸé–“ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
<div class="tabs">
    <button class="tab <%= mode === 'monthly' ? 'active' : '' %>" onclick="location.href='/ranking?mode=monthly&type=<%= rankingType %>'">
        ğŸ“… æœˆé–“ãƒ©ãƒ³ã‚­ãƒ³ã‚°
    </button>
    <button class="tab <%= mode === 'season' ? 'active' : '' %>" onclick="location.href='/ranking?mode=season&type=<%= rankingType %>'">
        ğŸ… ã‚·ãƒ¼ã‚ºãƒ³ãƒ©ãƒ³ã‚­ãƒ³ã‚°
    </button>
</div>

<!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¿ã‚¤ãƒ—ã‚¿ãƒ– -->
<div class="ranking-type-tabs">
    <% 
    const currentParams = mode === 'season' && selectedSeason ? `mode=${mode}&season_id=${selectedSeason.id}` : `mode=${mode}`;
    %>
    <button class="ranking-type-tab <%= rankingType === 'profit' ? 'active' : '' %>" onclick="location.href='/ranking?<%= currentParams %>&type=profit'">
        ğŸ’° åæ”¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°
    </button>
    <button class="ranking-type-tab <%= rankingType === 'hit_rate' ? 'active' : '' %>" onclick="location.href='/ranking?<%= currentParams %>&type=hit_rate'">
        ğŸ¯ çš„ä¸­ç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°
    </button>
    <button class="ranking-type-tab <%= rankingType === 'recovery_rate' ? 'active' : '' %>" onclick="location.href='/ranking?<%= currentParams %>&type=recovery_rate'">
        ğŸ“ˆ å›åç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°
    </button>
</div>

<!-- ã‚·ãƒ¼ã‚ºãƒ³é¸æŠï¼ˆã‚·ãƒ¼ã‚ºãƒ³ãƒ¢ãƒ¼ãƒ‰ã®æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
<% if (mode === 'season') { %>
<div class="season-selector">
<label for="season">ã‚·ãƒ¼ã‚ºãƒ³é¸æŠï¼š</label>
<select id="season" onchange="location.href='/ranking?mode=season&type=<%= rankingType %>&season_id='+this.value">
<% seasons.forEach(season => { %>
<option value="<%= season.id %>" <%= selectedSeason && selectedSeason.id === season.id ? 'selected' : '' %>>
<%= season.name %>
</option>
<% }); %>
</select>
</div>
<% } %>

<% if (mode === 'monthly' && currentMonth) { %>
<p style="margin-top: 10px; color: #667eea; font-weight: bold;">
    ğŸ“Š <%= currentMonth.year %>å¹´<%= currentMonth.month %>æœˆã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°
</p>
<% } %>

<a href="/" class="back-link">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</a>
<a href="/races" class="back-link">â† ãƒ¬ãƒ¼ã‚¹ä¸€è¦§</a>
</div>

<div class="section">
<%
let rankingTitle = '';
if (rankingType === 'profit') {
    rankingTitle = 'ğŸ’° åæ”¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°';
} else if (rankingType === 'hit_rate') {
    rankingTitle = 'ğŸ¯ çš„ä¸­ç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°';
} else if (rankingType === 'recovery_rate') {
    rankingTitle = 'ğŸ“ˆ å›åç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°';
}
%>
<h2><%= rankingTitle %></h2>
<% if (rankings.length === 0) { %>
<p style="color: #888;">ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
<% } else { %>
<table>
<thead>
<tr>
<th>é †ä½</th>
<th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
<th>ãƒ¬ãƒ¼ã‚¹æ•°</th>
<% if (rankingType === 'profit') { %>
<th>è³¼å…¥é¡</th>
<th>æ‰•æˆ»é¡</th>
<th>åæ”¯</th>
<% } else if (rankingType === 'hit_rate') { %>
<th>çš„ä¸­ç‡</th>
<th>çš„ä¸­æ•°/å‚åŠ æ•°</th>
<th>åæ”¯</th>
<% } else if (rankingType === 'recovery_rate') { %>
<th>å›åç‡</th>
<th>æ‰•æˆ»é¡</th>
<th>åæ”¯</th>
<% } %>
</tr>
</thead>
<tbody>
<% rankings.forEach((rank, index) => { %>
<tr class="<%= index < 3 ? `rank-${index + 1}` : '' %>">
<td>
<% if (index < 3) { %>
<% const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰']; %>
<span class="rank-badge badge-<%= index + 1 %>"><%= medals[index] %> <%= index + 1 %>ä½</span>
<% } else { %>
<strong><%= index + 1 %></strong>
<% } %>
</td>
<td><%= rank.display_name %></td>
<td><%= rank.race_count %></td>
<% if (rankingType === 'profit') { %>
<td><%= parseInt(rank.total_bet).toLocaleString() %>å††</td>
<td><%= parseInt(rank.total_payout).toLocaleString() %>å††</td>
<td class="<%= parseInt(rank.profit) >= 0 ? 'profit-positive' : 'profit-negative' %>">
<%= parseInt(rank.profit) >= 0 ? '+' : '' %><%= parseInt(rank.profit).toLocaleString() %>å††
</td>
<% } else if (rankingType === 'hit_rate') { %>
<td><strong style="font-size: 1.1em; color: #667eea;"><%= rank.hit_rate %>%</strong></td>
<td><%= rank.hit_race_count %>/<%= rank.race_count %></td>
<td class="<%= parseInt(rank.profit) >= 0 ? 'profit-positive' : 'profit-negative' %>">
<%= parseInt(rank.profit) >= 0 ? '+' : '' %><%= parseInt(rank.profit).toLocaleString() %>å††
</td>
<% } else if (rankingType === 'recovery_rate') { %>
<td><strong style="font-size: 1.1em; color: #667eea;"><%= rank.recovery_rate %>%</strong></td>
<td><%= parseInt(rank.total_payout).toLocaleString() %>å††</td>
<td class="<%= parseInt(rank.profit) >= 0 ? 'profit-positive' : 'profit-negative' %>">
<%= parseInt(rank.profit) >= 0 ? '+' : '' %><%= parseInt(rank.profit).toLocaleString() %>å††
</td>
<% } %>
</tr>
<% }); %>
</tbody>
</table>
<% } %>
</div>

</div>
</body>
</html>